function facebook_image_to_email(doc) {
    alert("Doing it.");
    
	if (doc.processed) return;
	
	doc.processed = true;
	
	var charMaps = [
	{ "letter" : "@", "width" : 7, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,228,230,228,255,149,157,147,255,70,84,66,255,70,84,66,255,70,84,66,255,123,133,120,255,228,230,228,255,70,84,66,255,149,157,147,255,255,255,255,255,255,255,255,255,255,255,255,255,175,181,174,255,70,84,66,255,149,157,147,255,202,206,201,255,70,84,66,255,70,84,66,255,96,108,93,255,44,60,40,255,149,157,147,255,228,230,228,255,70,84,66,255,202,206,201,255,255,255,255,255,228,230,228,255,44,60,40,255,202,206,201,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,228,230,228,255,228,230,228,255,70,84,66,255,175,181,174,255,228,230,228,255,175,181,174,255,44,60,40,255,202,206,201,255,149,157,147,255,202,206,201,255,96,108,93,255,96,108,93,255,175,181,174,255,96,108,93,255,123,133,120,255,96,108,93,255,123,133,120,255,228,230,228,255,255,255,255,255,255,255,255,255,228,230,228,255,255,255,255,255,255,255,255,255,149,157,147,255,96,108,93,255,70,84,66,255,70,84,66,255,96,108,93,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "m", "width" : 7, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,123,133,120,255,70,84,66,255,70,84,66,255,149,157,147,255,123,133,120,255,70,84,66,255,70,84,66,255,202,206,201,255,255,255,255,255,202,206,201,255,44,60,40,255,202,206,201,255,255,255,255,255,202,206,201,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "w", "width" : 5, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,175,181,174,255,255,255,255,255,175,181,174,255,70,84,66,255,255,255,255,255,123,133,120,255,255,255,255,255,123,133,120,255,70,84,66,255,228,230,228,255,70,84,66,255,255,255,255,255,96,108,93,255,175,181,174,255,149,157,147,255,70,84,66,255,175,181,174,255,149,157,147,255,228,230,228,255,96,108,93,255,123,133,120,255,70,84,66,255,202,206,201,255,255,255,255,255,96,108,93,255,175,181,174,255,70,84,66,255,255,255,255,255,255,255,255,255,149,157,147,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "a", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,96,108,93,255,70,84,66,255,70,84,66,255,175,181,174,255,255,255,255,255,255,255,255,255,202,206,201,255,70,84,66,255,96,108,93,255,70,84,66,255,70,84,66,255,44,60,40,255,202,206,201,255,255,255,255,255,228,230,228,255,44,60,40,255,228,230,228,255,255,255,255,255,175,181,174,255,44,60,40,255,70,84,66,255,70,84,66,255,123,133,120,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "b", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,123,133,120,255,70,84,66,255,70,84,66,255,44,60,40,255,228,230,228,255,255,255,255,255,149,157,147,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,149,157,147,255,44,60,40,255,96,108,93,255,70,84,66,255,96,108,93,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "d", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,96,108,93,255,70,84,66,255,96,108,93,255,44,60,40,255,175,181,174,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,202,206,201,255,255,255,255,255,202,206,201,255,44,60,40,255,70,84,66,255,70,84,66,255,96,108,93,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "g", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,96,108,93,255,70,84,66,255,96,108,93,255,44,60,40,255,175,181,174,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,202,206,201,255,255,255,255,255,202,206,201,255,44,60,40,255,70,84,66,255,70,84,66,255,96,108,93,255,70,84,66,255,255,255,255,255,255,255,255,255,202,206,201,255,96,108,93,255,96,108,93,255,70,84,66,255,96,108,93,255,228,230,228,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "h", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,123,133,120,255,70,84,66,255,70,84,66,255,44,60,40,255,202,206,201,255,255,255,255,255,202,206,201,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "k", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,228,230,228,255,70,84,66,255,44,60,40,255,228,230,228,255,70,84,66,255,202,206,201,255,44,60,40,255,70,84,66,255,175,181,174,255,255,255,255,255,44,60,40,255,175,181,174,255,70,84,66,255,228,230,228,255,44,60,40,255,255,255,255,255,149,157,147,255,96,108,93,255,44,60,40,255,255,255,255,255,255,255,255,255,96,108,93,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "n", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,123,133,120,255,70,84,66,255,70,84,66,255,44,60,40,255,202,206,201,255,255,255,255,255,202,206,201,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "o", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,202,206,201,255,96,108,93,255,70,84,66,255,96,108,93,255,70,84,66,255,202,206,201,255,255,255,255,255,149,157,147,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,70,84,66,255,202,206,201,255,255,255,255,255,149,157,147,255,202,206,201,255,70,84,66,255,70,84,66,255,96,108,93,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "p", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,123,133,120,255,70,84,66,255,70,84,66,255,44,60,40,255,228,230,228,255,255,255,255,255,149,157,147,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,149,157,147,255,44,60,40,255,96,108,93,255,70,84,66,255,96,108,93,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "q", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,96,108,93,255,70,84,66,255,96,108,93,255,44,60,40,255,175,181,174,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,202,206,201,255,255,255,255,255,202,206,201,255,44,60,40,255,70,84,66,255,70,84,66,255,123,133,120,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "u", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,228,230,228,255,255,255,255,255,175,181,174,255,149,157,147,255,70,84,66,255,70,84,66,255,123,133,120,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "v", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,175,181,174,255,255,255,255,255,255,255,255,255,123,133,120,255,96,108,93,255,255,255,255,255,255,255,255,255,70,84,66,255,44,60,40,255,228,230,228,255,175,181,174,255,123,133,120,255,123,133,120,255,149,157,147,255,96,108,93,255,202,206,201,255,202,206,201,255,70,84,66,255,70,84,66,255,255,255,255,255,255,255,255,255,70,84,66,255,149,157,147,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "y", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,175,181,174,255,255,255,255,255,255,255,255,255,123,133,120,255,96,108,93,255,255,255,255,255,228,230,228,255,70,84,66,255,70,84,66,255,228,230,228,255,149,157,147,255,123,133,120,255,149,157,147,255,149,157,147,255,70,84,66,255,228,230,228,255,228,230,228,255,44,60,40,255,96,108,93,255,255,255,255,255,255,255,255,255,70,84,66,255,175,181,174,255,255,255,255,255,228,230,228,255,70,84,66,255,255,255,255,255,255,255,255,255,123,133,120,255,149,157,147,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "_", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,70,84,66,255,70,84,66,255,70,84,66,255,70,84,66,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "4", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,149,157,147,255,44,60,40,255,255,255,255,255,149,157,147,255,123,133,120,255,44,60,40,255,149,157,147,255,123,133,120,255,228,230,228,255,44,60,40,255,123,133,120,255,255,255,255,255,228,230,228,255,44,60,40,255,70,84,66,255,70,84,66,255,70,84,66,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "6", "width" : 4, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,202,206,201,255,96,108,93,255,70,84,66,255,175,181,174,255,96,108,93,255,228,230,228,255,255,255,255,255,70,84,66,255,202,206,201,255,255,255,255,255,255,255,255,255,44,60,40,255,123,133,120,255,70,84,66,255,96,108,93,255,44,60,40,255,228,230,228,255,255,255,255,255,175,181,174,255,44,60,40,255,255,255,255,255,255,255,255,255,228,230,228,255,96,108,93,255,175,181,174,255,255,255,255,255,175,181,174,255,228,230,228,255,96,108,93,255,70,84,66,255,96,108,93,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "7", "width" : 3, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,70,84,66,255,70,84,66,255,70,84,66,255,255,255,255,255,255,255,255,255,202,206,201,255,255,255,255,255,255,255,255,255,96,108,93,255,255,255,255,255,202,206,201,255,70,84,66,255,255,255,255,255,96,108,93,255,175,181,174,255,202,206,201,255,70,84,66,255,255,255,255,255,96,108,93,255,175,181,174,255,255,255,255,255,70,84,66,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "8", "width" : 3, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,70,84,66,255,70,84,66,255,96,108,93,255,228,230,228,255,255,255,255,255,175,181,174,255,202,206,201,255,255,255,255,255,202,206,201,255,44,60,40,255,96,108,93,255,96,108,93,255,175,181,174,255,202,206,201,255,96,108,93,255,255,255,255,255,255,255,255,255,228,230,228,255,202,206,201,255,255,255,255,255,175,181,174,255,70,84,66,255,70,84,66,255,96,108,93,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "9", "width" : 3, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,96,108,93,255,70,84,66,255,96,108,93,255,202,206,201,255,255,255,255,255,149,157,147,255,255,255,255,255,255,255,255,255,228,230,228,255,202,206,201,255,255,255,255,255,202,206,201,255,70,84,66,255,70,84,66,255,123,133,120,255,255,255,255,255,255,255,255,255,202,206,201,255,255,255,255,255,255,255,255,255,96,108,93,255,70,84,66,255,70,84,66,255,175,181,174,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "5", "width" : 3, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,70,84,66,255,70,84,66,255,44,60,40,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,44,60,40,255,70,84,66,255,96,108,93,255,255,255,255,255,255,255,255,255,175,181,174,255,255,255,255,255,255,255,255,255,228,230,228,255,202,206,201,255,255,255,255,255,175,181,174,255,70,84,66,255,70,84,66,255,96,108,93,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "z", "width" : 3, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,70,84,66,255,70,84,66,255,70,84,66,255,255,255,255,255,228,230,228,255,70,84,66,255,255,255,255,255,96,108,93,255,149,157,147,255,123,133,120,255,96,108,93,255,255,255,255,255,70,84,66,255,228,230,228,255,255,255,255,255,70,84,66,255,70,84,66,255,70,84,66,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "0", "width" : 3, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,96,108,93,255,70,84,66,255,96,108,93,255,175,181,174,255,255,255,255,255,149,157,147,255,255,255,255,255,255,255,255,255,202,206,201,255,255,255,255,255,255,255,255,255,228,230,228,255,255,255,255,255,255,255,255,255,228,230,228,255,255,255,255,255,255,255,255,255,202,206,201,255,175,181,174,255,255,255,255,255,149,157,147,255,96,108,93,255,70,84,66,255,96,108,93,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "1", "width" : 3, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,175,181,174,255,44,60,40,255,255,255,255,255,44,60,40,255,44,60,40,255,255,255,255,255,202,206,201,255,44,60,40,255,255,255,255,255,202,206,201,255,44,60,40,255,255,255,255,255,202,206,201,255,44,60,40,255,255,255,255,255,202,206,201,255,44,60,40,255,255,255,255,255,202,206,201,255,44,60,40,255,255,255,255,255,70,84,66,255,44,60,40,255,96,108,93,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "2", "width" : 3, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,70,84,66,255,70,84,66,255,70,84,66,255,228,230,228,255,255,255,255,255,149,157,147,255,255,255,255,255,255,255,255,255,228,230,228,255,255,255,255,255,255,255,255,255,149,157,147,255,255,255,255,255,202,206,201,255,70,84,66,255,202,206,201,255,70,84,66,255,228,230,228,255,70,84,66,255,228,230,228,255,255,255,255,255,70,84,66,255,70,84,66,255,70,84,66,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "3", "width" : 3, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,96,108,93,255,70,84,66,255,70,84,66,255,255,255,255,255,255,255,255,255,202,206,201,255,255,255,255,255,255,255,255,255,149,157,147,255,228,230,228,255,70,84,66,255,123,133,120,255,255,255,255,255,255,255,255,255,149,157,147,255,255,255,255,255,255,255,255,255,228,230,228,255,255,255,255,255,255,255,255,255,149,157,147,255,70,84,66,255,70,84,66,255,96,108,93,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "x", "width" : 3, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,123,133,120,255,255,255,255,255,228,230,228,255,70,84,66,255,175,181,174,255,123,133,120,255,202,206,201,255,44,60,40,255,96,108,93,255,228,230,228,255,70,84,66,255,96,108,93,255,70,84,66,255,202,206,201,255,96,108,93,255,123,133,120,255,255,255,255,255,228,230,228,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "c", "width" : 3, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,123,133,120,255,70,84,66,255,96,108,93,255,149,157,147,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,149,157,147,255,255,255,255,255,255,255,255,255,96,108,93,255,70,84,66,255,70,84,66,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "e", "width" : 3, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,96,108,93,255,70,84,66,255,70,84,66,255,202,206,201,255,255,255,255,255,202,206,201,255,70,84,66,255,70,84,66,255,70,84,66,255,255,255,255,255,255,255,255,255,255,255,255,255,175,181,174,255,255,255,255,255,228,230,228,255,96,108,93,255,70,84,66,255,70,84,66,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "r.", "width" : 3, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,123,133,120,255,70,84,66,255,44,60,40,255,228,230,228,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,228,230,228,255,44,60,40,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "r", "width" : 3, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,44,60,40,255,123,133,120,255,70,84,66,255,44,60,40,255,228,230,228,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "s", "width" : 2, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,70,84,66,255,70,84,66,255,228,230,228,255,255,255,255,255,70,84,66,255,96,108,93,255,255,255,255,255,175,181,174,255,255,255,255,255,202,206,201,255,70,84,66,255,70,84,66,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "t", "width" : 2, "map" : [255,255,255,255,255,255,255,255,123,133,120,255,255,255,255,255,44,60,40,255,255,255,255,255,44,60,40,255,70,84,66,255,44,60,40,255,255,255,255,255,44,60,40,255,255,255,255,255,44,60,40,255,255,255,255,255,44,60,40,255,255,255,255,255,123,133,120,255,70,84,66,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "f", "width" : 2, "map" : [255,255,255,255,255,255,255,255,149,157,147,255,70,84,66,255,44,60,40,255,255,255,255,255,44,60,40,255,70,84,66,255,44,60,40,255,255,255,255,255,44,60,40,255,255,255,255,255,44,60,40,255,255,255,255,255,44,60,40,255,255,255,255,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "-", "width" : 2, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,70,84,66,255,70,84,66,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "i", "width" : 1, "map" : [255,255,255,255,96,108,93,255,255,255,255,255,44,60,40,255,44,60,40,255,44,60,40,255,44,60,40,255,44,60,40,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "j", "width" : 1, "map" : [255,255,255,255,96,108,93,255,255,255,255,255,44,60,40,255,44,60,40,255,44,60,40,255,44,60,40,255,44,60,40,255,44,60,40,255,70,84,66,255,175,181,174,255,255,255,255,255,255,255,255,255]},
	{ "letter" : "l", "width" : 1, "map" : [255,255,255,255,44,60,40,255,44,60,40,255,44,60,40,255,44,60,40,255,44,60,40,255,44,60,40,255,44,60,40,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},
	{ "letter" : ".", "width" : 1, "map" : [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,228,230,228,255,44,60,40,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]}
	];
	
	var charMapLength = charMaps.length;

	function decode(context, left, top, width, height) {
		var save = new Array(width);
		var cwidth = width;
		var cheight = height;
		for (var i = 0; i < charMapLength; i++) {
			var character = charMaps[i];
			
			var width = character.width;
			var map = character.map;
		
			for (var c = 0; c + width < cwidth; c++){
				if (isOpen(save, c, c+width)){
					try {
						var uMap = context.getImageData(c + left, top, width, cheight).data;
						
						if (cheight < 13) {
							for (var e = 0; e < ((13 - cheight) * 4 * width); e++){
								uMap.push(255);
							}
						}
						
						if (equalArrays(uMap, map)){
							save[c] = character.letter;
				
							for (var x = 1; x < width; x++){
								save[c+x] = "";
							}

							c += width;
						}
					} catch (e) { alert(e); return;}
				}
			}
		}
	
		return save.join("");
	}

	function isOpen(arr, start, end) {
		for (var i = start; i < end; i++){
			if (typeof(arr[i]) != "undefined") return false;
		}
	
		return true;
	}
	
	function equalArrays(arr1, arr2) {
		var arr1Length = arr1.length;
		
		if (arr1Length != arr2.length) {
			return false;
		}
		else {
			for (var i = 0; i < arr1Length; i++){
				if (Math.abs(arr1[i] - arr2[i]) > 25){
					return false
				}
			}
		}
		
		return true;
	}
	
	var numImages = doc.images.length;
	
	// Get a screenshot of the page.
	// By doing it this way, and not by playing with the generated-text images
	// directly, we avoid certain cross-domain security rules for canvas access.
	var pageContext = Screengrab.grabFullPageContext(doc);
	
	for (var q = numImages - 1; q >= 0; q--) {
		var image = doc.images[q];
		
		if (image.src  && image.src.match(/string_image/)) {
		    clearTimeout(fb_ite_timer);
		    
			// Get the location of the image on the page.
			var left = 0;
			var top = 0;

			var theNode = image;

			do {
				top += theNode.offsetTop;
				left += theNode.offsetLeft;
				theNode = theNode.offsetParent;
			} while (theNode != doc.body);

			// Decode the address out of the full page image, not just by itself
			var address = decode(pageContext, left, top, image.width, image.height);
			
			if (address.indexOf("@") != -1 && address.indexOf(".") != -1) {
				var a = doc.createElement("a");
				a.setAttribute("href", "mailto:" + address);
				a.innerHTML = address;
			
				image.parentNode.insertBefore(a, image);
				image.parentNode.removeChild(image);
			}
			else {
				var a = doc.createElement("a");
				a.setAttribute("href","javascript:void(0);");
				a.setAttribute("onclick","alert('Facebook Image-to-Email could not convert this image to text; best guess was \""+address+"\"');");
				a.innerHTML = "<sup>?</sup>";
				
				if (image.nextSibling) {
					image.parentNode.insertBefore(a, image.nextSibling);
				}
				else {
					image.parentNode.appendChild(a);
				}
			}
		}
	}
}